{% extends "layout_fullwidth-v2.html" %}

{% block headerContent %}

<button type="button" role="button" class="govuk-header__menu-button js-header-toggle" aria-controls="navigation"
    aria-label="Show or hide Top Level Navigation">Menu</button>
{% include "includes/nav.html" %}

{% endblock %}

{% block pageTitle %}
Search the personal licence register
{% endblock %}


{% block headerInfo %}
{% include "includes/beta.html" %}
{% endblock %}


{% block beforeContent %}

<a href="/{{version}}/personal/summary" class="govuk-back-link">Back</a>

{% endblock %}

{% block content %}

<div class="govuk-grid-row">

    <div class="govuk-grid-column-two-thirds">

        <div class="gc-register-search gc-register-search--whitebg">
            <form method="POST" action="results">
                <label for="search" class="govuk-label">
                    <h1 class="govuk-heading-l  govuk-!-margin-bottom-3">
                        Search the personal licence register
                    </h1>

                </label>
                <span class="govuk-hint">
                    Search by name or account number
                </span>
                <div class="inner-form govuk-!-margin-bottom-3">
                    <div class="input-field second-wrap">
                        <input id="search" name="search" type="text" placeholder="Search"
                            value="{{ data['search'] }}" />
                    </div>
                    <div class="input-field third-wrap">
                        <button class="btn-search" type="submit"><span class="govuk-visually-hidden">Search the
                                register</span>
                            <svg class="svg-inline--fa fa-search fa-w-16" aria-hidden="true" data-prefix="fas"
                                data-icon="search" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                <path fill="currentColor"
                                    d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z">
                                </path>
                            </svg>
                        </button>
                    </div>
                </div>
            </form>


        </div>
    </div>

    <div class="govuk-grid-column-one-third">

    </div>

</div>

<div class="govuk-grid-row">

    {% if emptySearch === 'true'%}

    <div class="govuk-grid-column-two-thirds">
        <h3 class="govuk-heading-m">
            No results found
        </h3>
        <p class="govuk-body">If you want the full register, find out how to <a
                href="/{{version}}/personal/summary">download the register</a> in different formats.</p>
    </div>

    {% else %}

    <div class="govuk-grid-column-one-third">



            <form method="POST" action="full">


                    <details class="govuk-details">
                        <summary class="govuk-details__summary">
                            <span class="govuk-details__summary-text">
                                Filter the results
                            </span>
                        </summary>
                        <div class="govuk-details__text">



                            <div class="gc-filters">

                     
                                <div class="govuk-form-group">
                                        <fieldset class="govuk-fieldset">
                                                <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
                                                        <h3 class="govuk-fieldset__heading">
                                                            Activity
                                                        </h3>
                                                    </legend>
                                                <div class="govuk-checkboxes govuk-checkboxes--small">
                                                    <div class="govuk-checkboxes__item">
                                                        <input class="govuk-checkboxes__input" id="sector-1" name="sector"
                                                            type="checkbox" value="Arcades">
                                                        <label class="govuk-label govuk-checkboxes__label" for="sector-1">
                                                            Personal management (PML)
                                                        </label> </div>
                                                    <div class="govuk-checkboxes__item">
                                                        <input class="govuk-checkboxes__input" id="sector-2" name="sector"
                                                            type="checkbox" value="Betting">
                                                        <label class="govuk-label govuk-checkboxes__label" for="sector-2">
                                                            Personal functional (PFL)
                                                        </label> </div>
                                                   
                                                </div>
                                            </fieldset>
                                </div>

                                <div class="govuk-form-group">
                                        <fieldset class="govuk-fieldset">
                                                <legend class="govuk-fieldset__legend govuk-fieldset__legend--s">
                                                        <h3 class="govuk-fieldset__heading">
                                                            Status
                                                        </h3>
                                                    </legend>
                                                <div class="govuk-checkboxes govuk-checkboxes--small">
                                                    <div class="govuk-checkboxes__item">
                                                        <input class="govuk-checkboxes__input" id="status-1" name="status"
                                                            type="checkbox" value="Active">
                                                        <label class="govuk-label govuk-checkboxes__label" for="status-1">
                                                            Active
                                                        </label> </div>
                                                    <div class="govuk-checkboxes__item">
                                                        <input class="govuk-checkboxes__input" id="status-2" name="status"
                                                            type="checkbox" value="Expired">
                                                        <label class="govuk-label govuk-checkboxes__label" for="status-2">
                                                            Expired
                                                        </label> </div>
                                                    <div class="govuk-checkboxes__item">
                                                        <input class="govuk-checkboxes__input" id="status-3" name="status"
                                                            type="checkbox" value="Forfeited">
                                                        <label class="govuk-label govuk-checkboxes__label" for="status-3">
                                                            Forfeited
                                                        </label> </div>
                                                    <div class="govuk-checkboxes__item">
                                                        <input class="govuk-checkboxes__input" id="status-4" name="status"
                                                            type="checkbox" value="Lapsed">
                                                        <label class="govuk-label govuk-checkboxes__label" for="status-4">
                                                            Lapsed
                                                        </label> </div>
                                                    <div class="govuk-checkboxes__item">
                                                        <input class="govuk-checkboxes__input" id="status-5" name="status"
                                                            type="checkbox" value="Revoked">
                                                        <label class=" govuk-label govuk-checkboxes__label" for="status-5">
                                                            Revoked
                                                        </label> </div>
                                                    <div class="govuk-checkboxes__item">
                                                        <input class="govuk-checkboxes__input" id="status-6" name="status"
                                                            type="checkbox" value="Surrendered">
                                                        <label class="govuk-label govuk-checkboxes__label" for="status-6">
                                                            Surrendered
                                                        </label> </div>
                                                    <div class="govuk-checkboxes__item">
                                                        <input class="govuk-checkboxes__input" id="status-7" name="status"
                                                            type="checkbox" value="Suspended">
                                                        <label class="govuk-label govuk-checkboxes__label" for="status-7">
                                                            Suspended
                                                        </label> </div>
        
                                                </div>
                                            </fieldset>
                                </div>

                                <button type="submit" class="govuk-button">
                                    Apply filters
                                </button>

                            </div>

                        </div>
                    </details>
                </form>

    </div>
    
    <div class="govuk-grid-column-two-thirds">



        {% if(result.registerData.recordset.length === 0)%}


        <h3 class="govuk-heading-m">
            Nothing found for "{{data['search']}}"

            {% if data['status'] === undefined %}
            {% elseif data['status'] == 'Granted,Pending' %}
            with a status of "active or pending"
            {% elseif data['status'] == 'Pending' %}
            with a status of "pending"
            {% elseif data['status'] == 'Granted' %}
            with a status of "active"
            {% endif %}

        </h3>


        {%else%} <p class="govuk-body govuk-!-margin-bottom-2">
            <span class="govuk-!-font-weight-bold">{{result.registerData.recordset.length | numeral("0,0") }}</span>
            results</p>
        <hr class="govuk-section-break govuk-!-margin-bottom-4 govuk-!-margin-top-1 govuk-section-break--visible">
        {% endif %}


        {% for accountno, ai in result.registerData.recordset | groupby('accountno') %}

{%for base, i in ai | groupby('accountno') %}

        {% set accountNumber = 0%}

        {% if accountNumber !== i.accountno %}
        {% set accountNumber = i.accountno%}

        <div class="gc-search-result">
            <span class="gc-pull-right">
                <span class="govuk-tag">{{accountno}}</span></span>

            <h3 class="govuk-heading-s  govuk-!-margin-bottom-2"  ga-on="click" ga-event-category="PLSearch" ga-event-action="Click" ga-event-label="{{ loop.index }}¬{{ loop.length }}¬{{accountno}}¬{{data['search']}">
                <a href="/{{version}}/personal/detail/{{accountno}}">
                    {{i[0].Applicantfirstname}} {{ai[0].Applicantsurname | upper}}</a>

            </h3>

            <ul class="gc-search-result--tag">

                                  
                {% for product in ai %}
                <li>{{product.product | replace('- N','') | upper}}</li>
                {% endfor %}
                </ul>
    

            <ul class="gc-search-result--tag">

                <li>{{i[0].towncity | capitalize}}</li>               
          
          


        </div>
        {% endif %}
        {% endfor %}
        {% endfor %}

    </div>

    {% endif%}

</div>

{% endblock %}